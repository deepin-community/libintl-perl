Subject: Remove . from @INC when loading modules dynamically [CVE-2016-1238]
Bug-Debian: https://bugs.debian.org/832440
Bug: https://rt.cpan.org/Public/Bug/Display.html?id=116772
Acked-by: Dominic Hargreaves <dom@earth.li>
Last-Update: 2016-08-14

--- a/lib/Locale/Messages.pm
+++ b/lib/Locale/Messages.pm
@@ -28,6 +28,8 @@
 
 # Try to load the C version first.
 $package = 'gettext_xs';
+local @INC = @INC;
+pop @INC if $INC[-1] eq '.';
 eval <<'EOF';
 require Locale::gettext_xs; 
 my $version = Locale::gettext_xs::__gettext_xs_version();
@@ -40,6 +42,8 @@
 #
 # On such systems, we always fall back to gettext_dumb.
 if ($no_xs) {
+    local @INC = @INC;
+    pop @INC if $INC[-1] eq '.';
     eval {
         require POSIX;
         # void
@@ -200,9 +204,15 @@
         my $filename = "Locale::$pkg";
         $filename =~ s{::|\'}{/};
 	$filename .= '.pm';
-        eval { require $filename };
+        eval {
+            local @INC = @INC;
+            pop @INC if $INC[-1] eq '.';
+            require $filename
+        };
 	$package = $pkg unless $@;   
     } else {
+        local @INC = @INC;
+        pop @INC if $INC[-1] eq '.';
         eval "require Locale::gettext_xs";
         $package = 'gettext_xs' unless $@;
     }
